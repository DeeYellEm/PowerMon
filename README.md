# PowerMon
PowerMon was written to solve a fairly small problem.  The power where I live is a bit unstable, but I couldn't say *how* unstable.  I couldn't say how often it went out or for how long and the local PUD wasn't sharing that info.  So, I thought I'd create a project to track that info.

The solution I settled on was using an old, retired Raspberry Pi 2b.  It's connected to my network and running an Apache server to serve content only on the local network.  The content it serves is a single file which lists the history of power outages that PowerMon has tracked.  

The algorithm is simple:
Every time powermon.py is run, it's because the PowerMon Raspberry Pi had a power outage.  When power returns, the Raspberry Pi boots and starts up the powermon.py script via the crontab entry below.  Additionally, it runs another script which parses data files every minute and generates the table which is loaded in the index.php file.

```
# For more information see the manual pages of crontab(5) and cron(8)
#
# m h  dom mon dow   command
@reboot sudo /usr/bin/python3 /home/homedir/PowerMon/powermon.py
* * * * * /usr/bin/python3 /home/homedir/PowerMon/genOutageTable.py
```

The files in the project are:
Outages : a directory of small files which are written each time powermon.py initially runs due to a power outage.  These files capture the time of recover and the duration by calculating the difference between the current time and the last time the time was checked.
README.md : This file
genOutageTable.py : A small script which writes the table which will be inserted in to index.php.  It also copies the file to /var/www/html/PowerMon which is the only directory open to write to and only for the main user and the www-data group.
index.php : The very simple page that is the only content served by the Apache server on the Raspberry Pi only to the local network (there's no realistic reason I will want to do this remotely).  Note, just because it looked nicer, index.php uses Bootstrap for a cleaner presentation.  Additional note: the index.php uses the tag "<meta http-equiv=\"refresh\" content=\"60\">" to cause the page to reload every minute in case anyone loads the page and wants to see it update on the minute versus just hit it once for the latest data.
lastDateTime.txt : what it says, the last time the date/time was captured.  It looks like this: 2024-05-08 20:31:51
outageTable.html : The table element generated by genOutageTable.py
powermon.log : powermon.py logs some small amounts of data like when it runs the first time or if there is an error due to a directory or important file becoming unavailable.
uptime.txt : The calculated value which represents the difference between the current time and the time the scrip started.  It was just easier to write it out in powermon.py and then read it in from genOutageTable.py because in addition to any power outage events, the page also lists the uptime and date/time of the last run.
